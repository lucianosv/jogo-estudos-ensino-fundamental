// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

const SUPABASE_URL_ENV = import.meta.env.VITE_SUPABASE_URL as string | undefined;
const SUPABASE_ANON_KEY_ENV = import.meta.env.VITE_SUPABASE_ANON_KEY as string | undefined;

// User-provided defaults for hosted environments without env management
const SUPABASE_URL_DEFAULT = 'https://xjvqjfxcdyjjkbqxhdlo.supabase.co';
const SUPABASE_ANON_KEY_DEFAULT = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhqdnFqZnhjZHlqamticXhoZGxvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkwODczMTIsImV4cCI6MjA2NDY2MzMxMn0.kjOlLD3PU9QqTeDlPbpE6QZL5KjM84kDQgdvUlwIlnk';

const SUPABASE_URL = SUPABASE_URL_ENV || SUPABASE_URL_DEFAULT;
const SUPABASE_ANON_KEY = SUPABASE_ANON_KEY_ENV || SUPABASE_ANON_KEY_DEFAULT;

// Graceful fallback: if nothing is available, export a stub client that won't crash the app
function createStubClient() {
  const notConfiguredError = new Error('Supabase is not configured');
  const noData = { data: null as any, error: notConfiguredError };

  const stub = {
    auth: {
      async getSession() {
        return { data: { session: null }, error: null };
      },
      onAuthStateChange(_cb: any) {
        return { data: { subscription: { unsubscribe: () => {} } } } as any;
      },
      async signUp() { return noData; },
      async signInWithPassword() { return noData; },
      async signOut() { return noData; },
    },
    from() {
      return {
        select: async () => noData,
        single: async () => noData,
        update: async () => noData,
        delete: async () => noData,
        eq: () => ({ select: async () => noData, update: async () => noData, delete: async () => noData }),
        neq: () => ({ delete: async () => noData })
      } as any;
    },
    functions: {
      async invoke() { return noData; }
    }
  };

  if (typeof console !== 'undefined') {
    // eslint-disable-next-line no-console
    console.warn('[Supabase] Using stub client; configuration is missing.');
  }

  return stub as any;
}

export const supabase = (SUPABASE_URL && SUPABASE_ANON_KEY)
  ? createClient<Database>(SUPABASE_URL, SUPABASE_ANON_KEY)
  : createStubClient();