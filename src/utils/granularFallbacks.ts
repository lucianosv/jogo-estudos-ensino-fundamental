
import { GameParameters } from "@/components/GameSetup";

interface GranularQuestion {
  content: string;
  choices: string[];
  answer: string;
  word: string;
}

interface GranularStory {
  title: string;
  content: string;
}

// Fallbacks organizados por Mat√©ria > S√©rie > Tema
const granularFallbacks = {
  'Matem√°tica': {
    '1¬∫ ano': {
      'N√∫meros': {
        questions: [
          {
            content: "Contando com os dedos: Se voc√™ levanta 2 dedos de uma m√£o e 3 da outra, quantos dedos voc√™ tem levantados?",
            choices: ["4 dedos", "5 dedos", "6 dedos", "7 dedos"],
            answer: "5 dedos",
            word: "soma"
          },
          {
            content: "Quantos objetos h√° na figura: üçéüçéüçé?",
            choices: ["1 objeto", "2 objetos", "3 objetos", "4 objetos"],
            answer: "3 objetos",
            word: "contar"
          },
          {
            content: "Se voc√™ tem 4 brinquedos e ganha mais 1, quantos brinquedos voc√™ tem no total?",
            choices: ["3 brinquedos", "4 brinquedos", "5 brinquedos", "6 brinquedos"],
            answer: "5 brinquedos",
            word: "total"
          },
          {
            content: "Qual √© o n√∫mero que vem depois do 7?",
            choices: ["6", "7", "8", "9"],
            answer: "8",
            word: "sequ√™ncia"
          }
        ],
        story: {
          title: "A Aventura dos N√∫meros",
          content: "Era uma vez uma crian√ßa curiosa que adorava contar tudo ao seu redor. Ela contava os brinquedos, os dedos, as estrelas no c√©u. Um dia, descobriu que os n√∫meros tinham poderes m√°gicos e podia us√°-los para resolver problemas do dia a dia. Que aventura matem√°tica incr√≠vel a esperava!"
        }
      }
    },
    '4¬∫ ano': {
      'Multiplica√ß√£o': {
        questions: [
          {
            content: "Na feira, uma banca vende ma√ß√£s em sacos de 6 unidades. Se voc√™ comprar 4 sacos, quantas ma√ß√£s ter√°?",
            choices: ["18 ma√ß√£s", "20 ma√ß√£s", "24 ma√ß√£s", "26 ma√ß√£s"],
            answer: "24 ma√ß√£s",
            word: "produto"
          },
          {
            content: "Uma caixa tem 8 l√°pis. Quantos l√°pis h√° em 3 caixas?",
            choices: ["20 l√°pis", "22 l√°pis", "24 l√°pis", "26 l√°pis"],
            answer: "24 l√°pis",
            word: "multiplicar"
          },
          {
            content: "Se cada mesa da sala tem 4 cadeiras e h√° 5 mesas, quantas cadeiras h√° no total?",
            choices: ["16 cadeiras", "18 cadeiras", "20 cadeiras", "22 cadeiras"],
            answer: "20 cadeiras",
            word: "conjunto"
          },
          {
            content: "Jo√£o tem 7 potes com 3 biscoitos cada. Quantos biscoitos ele tem?",
            choices: ["19 biscoitos", "20 biscoitos", "21 biscoitos", "22 biscoitos"],
            answer: "21 biscoitos",
            word: "grupos"
          }
        ],
        story: {
          title: "O Mercado Matem√°tico",
          content: "No mercado da cidade, os vendedores usavam a multiplica√ß√£o para calcular rapidamente quantos produtos vendiam. Ana descobriu que podia ajudar sua av√≥ no mercado usando seus conhecimentos de multiplica√ß√£o. Cada c√°lculo correto a aproximava de se tornar a melhor ajudante da feira!"
        }
      }
    },
    '7¬∫ ano': {
      '√Ålgebra': {
        questions: [
          {
            content: "Se em uma equa√ß√£o x + 8 = 15, qual √© o valor de x?",
            choices: ["5", "6", "7", "8"],
            answer: "7",
            word: "inc√≥gnita"
          },
          {
            content: "Resolva: 2y = 14. Qual √© o valor de y?",
            choices: ["6", "7", "8", "9"],
            answer: "7",
            word: "vari√°vel"
          },
          {
            content: "Se a + 12 = 20, qual √© o valor de a?",
            choices: ["6", "7", "8", "9"],
            answer: "8",
            word: "equa√ß√£o"
          },
          {
            content: "Em 3z - 6 = 9, qual √© o valor de z?",
            choices: ["3", "4", "5", "6"],
            answer: "5",
            word: "solu√ß√£o"
          }
        ],
        story: {
          title: "O Mist√©rio das Inc√≥gnitas",
          content: "No laborat√≥rio matem√°tico, o professor apresentou um desafio: encontrar valores desconhecidos usando pistas num√©ricas. Cada equa√ß√£o era como um enigma a ser desvendado, onde o X representava um tesouro escondido esperando para ser descoberto atrav√©s da l√≥gica e do racioc√≠nio."
        }
      }
    }
  },
  'Ci√™ncias': {
    '3¬∫ ano': {
      'Sistema Solar': {
        questions: [
          {
            content: "Qual √© a estrela mais importante para a vida na Terra?",
            choices: ["A Lua", "O Sol", "As estrelas", "Os cometas"],
            answer: "O Sol",
            word: "estrela"
          },
          {
            content: "Quantos planetas existem no Sistema Solar?",
            choices: ["7 planetas", "8 planetas", "9 planetas", "10 planetas"],
            answer: "8 planetas",
            word: "planeta"
          },
          {
            content: "Qual √© o planeta mais pr√≥ximo do Sol?",
            choices: ["V√™nus", "Terra", "Merc√∫rio", "Marte"],
            answer: "Merc√∫rio",
            word: "√≥rbita"
          },
          {
            content: "O que a Terra faz ao redor do Sol?",
            choices: ["Gira", "Para", "Cresce", "Diminui"],
            answer: "Gira",
            word: "movimento"
          }
        ],
        story: {
          title: "Viagem pelo Sistema Solar",
          content: "Imagine que voc√™ √© um astronauta em uma nave espacial explorando nosso Sistema Solar. Voc√™ passa pelo Sol brilhante, visita planetas coloridos como Marte vermelho e J√∫piter gigante, e aprende que cada planeta tem suas pr√≥prias caracter√≠sticas especiais. Que descobertas incr√≠veis voc√™ faria nesta jornada espacial!"
        }
      }
    },
    '6¬∫ ano': {
      'Corpo Humano': {
        questions: [
          {
            content: "Qual √≥rg√£o √© respons√°vel por bombear sangue para todo o corpo?",
            choices: ["Pulm√£o", "F√≠gado", "Cora√ß√£o", "Est√¥mago"],
            answer: "Cora√ß√£o",
            word: "circula√ß√£o"
          },
          {
            content: "Qual √≥rg√£o nos permite respirar?",
            choices: ["Cora√ß√£o", "Pulm√£o", "F√≠gado", "Rim"],
            answer: "Pulm√£o",
            word: "respira√ß√£o"
          },
          {
            content: "Onde fica o c√©rebro humano?",
            choices: ["No peito", "Na barriga", "Na cabe√ßa", "Nas pernas"],
            answer: "Na cabe√ßa",
            word: "pensamento"
          },
          {
            content: "Quantos ossos principais formam o bra√ßo humano?",
            choices: ["1 osso", "2 ossos", "3 ossos", "4 ossos"],
            answer: "2 ossos",
            word: "esqueleto"
          }
        ],
        story: {
          title: "A Incr√≠vel M√°quina Humana",
          content: "Seu corpo √© como uma m√°quina perfeita onde cada √≥rg√£o tem uma fun√ß√£o importante. O cora√ß√£o trabalha sem parar bombeando sangue, os pulm√µes captam oxig√™nio, o c√©rebro comanda tudo. Descobrir como funciona esta m√°quina incr√≠vel que √© o corpo humano √© uma aventura fascinante pela vida!"
        }
      }
    }
  },
  'Hist√≥ria': {
    '5¬∫ ano': {
      'Grandes Navega√ß√µes': {
        questions: [
          {
            content: "Qual tipo de embarca√ß√£o foi mais utilizada pelos portugueses nas Grandes Navega√ß√µes?",
            choices: ["Canoa", "Caravela", "Jangada", "Submarino"],
            answer: "Caravela",
            word: "descoberta"
          },
          {
            content: "Quem foi o navegador portugu√™s que chegou ao Brasil em 1500?",
            choices: ["Vasco da Gama", "Pedro √Ålvares Cabral", "Crist√≥v√£o Colombo", "Fern√£o de Magalh√£es"],
            answer: "Pedro √Ålvares Cabral",
            word: "navegador"
          },
          {
            content: "Qual oceano os portugueses navegaram para chegar √†s √çndias?",
            choices: ["Oceano Pac√≠fico", "Oceano √Årtico", "Oceano Atl√¢ntico", "Oceano √çndico"],
            answer: "Oceano Atl√¢ntico",
            word: "oceano"
          },
          {
            content: "O que os navegadores usavam para se orientar no mar?",
            choices: ["Celular", "B√∫ssola", "Televis√£o", "R√°dio"],
            answer: "B√∫ssola",
            word: "orienta√ß√£o"
          }
        ],
        story: {
          title: "Os Corajosos Navegadores",
          content: "H√° muito tempo, navegadores corajosos sa√≠am em caravelas para explorar oceanos desconhecidos. Eles enfrentavam tempestades, descobriam novas terras e povos diferentes. Cada viagem era uma aventura cheia de perigos e descobertas que mudaram a hist√≥ria do mundo para sempre."
        }
      }
    },
    '8¬∫ ano': {
      'Revolu√ß√£o Francesa': {
        questions: [
          {
            content: "Qual foi o lema principal da Revolu√ß√£o Francesa?",
            choices: ["Paz e Amor", "Liberdade, Igualdade, Fraternidade", "For√ßa e Honra", "Trabalho e Progresso"],
            answer: "Liberdade, Igualdade, Fraternidade",
            word: "revolu√ß√£o"
          },
          {
            content: "Em que s√©culo aconteceu a Revolu√ß√£o Francesa?",
            choices: ["S√©culo XVI", "S√©culo XVII", "S√©culo XVIII", "S√©culo XIX"],
            answer: "S√©culo XVIII",
            word: "s√©culo"
          },
          {
            content: "Qual era a classe social mais privilegiada antes da Revolu√ß√£o Francesa?",
            choices: ["Camponeses", "Burguesia", "Nobreza", "Clero"],
            answer: "Nobreza",
            word: "nobreza"
          },
          {
            content: "Qual s√≠mbolo representa a Revolu√ß√£o Francesa?",
            choices: ["A √°guia", "O le√£o", "A coroa", "A bandeira tricolor"],
            answer: "A bandeira tricolor",
            word: "s√≠mbolo"
          }
        ],
        story: {
          title: "A Revolu√ß√£o que Mudou o Mundo",
          content: "Na Fran√ßa do s√©culo XVIII, o povo se levantou contra a injusti√ßa e a desigualdade. Gritando por liberdade, igualdade e fraternidade, eles mudaram n√£o apenas seu pa√≠s, mas inspiraram revolu√ß√µes ao redor do mundo. Foi um momento hist√≥rico que mostrou o poder do povo lutando por seus direitos."
        }
      }
    }
  },
  'Portugu√™s': {
    '3¬∫ ano': {
      'Alfabeto': {
        questions: [
          {
            content: "Quantas letras tem o alfabeto portugu√™s?",
            choices: ["24 letras", "25 letras", "26 letras", "27 letras"],
            answer: "26 letras",
            word: "alfabeto"
          },
          {
            content: "Quantas vogais existem no alfabeto?",
            choices: ["3 vogais", "4 vogais", "5 vogais", "6 vogais"],
            answer: "5 vogais",
            word: "vogal"
          },
          {
            content: "Qual √© a primeira letra do alfabeto?",
            choices: ["B", "A", "C", "D"],
            answer: "A",
            word: "primeira"
          },
          {
            content: "As letras que n√£o s√£o vogais s√£o chamadas de:",
            choices: ["N√∫meros", "Consoantes", "S√≠mbolos", "Acentos"],
            answer: "Consoantes",
            word: "consoante"
          }
        ],
        story: {
          title: "O Reino das Letras",
          content: "No Reino das Letras, cada letra tinha um som especial e juntas formavam palavras m√°gicas. As vogais A, E, I, O, U eram as rainhas que davam vida √†s palavras, enquanto as consoantes eram os guerreiros que davam for√ßa. Juntas, elas criavam hist√≥rias incr√≠veis!"
        }
      }
    },
    '6¬∫ ano': {
      'Substantivos': {
        questions: [
          {
            content: "Qual das palavras abaixo √© um substantivo pr√≥prio?",
            choices: ["cidade", "Brasil", "animal", "bonito"],
            answer: "Brasil",
            word: "substantivo"
          },
          {
            content: "Qual palavra √© um substantivo comum?",
            choices: ["Jo√£o", "S√£o Paulo", "livro", "Maria"],
            answer: "livro",
            word: "comum"
          },
          {
            content: "Os substantivos pr√≥prios sempre come√ßam com:",
            choices: ["Letra min√∫scula", "Letra mai√∫scula", "N√∫mero", "S√≠mbolo"],
            answer: "Letra mai√∫scula",
            word: "pr√≥prio"
          },
          {
            content: "Qual √© a fun√ß√£o do substantivo na frase?",
            choices: ["Dar a√ß√£o", "Dar nome", "Dar cor", "Dar som"],
            answer: "Dar nome",
            word: "fun√ß√£o"
          }
        ],
        story: {
          title: "A Fam√≠lia das Palavras",
          content: "No mundo da gram√°tica, as palavras viviam em fam√≠lias organizadas. Os substantivos eram respons√°veis por dar nome a tudo: pessoas, lugares, objetos e sentimentos. Alguns eram pr√≥prios, como nomes de pessoas e cidades, outros eram comuns, como mesa e cadeira. Cada um tinha sua import√¢ncia na constru√ß√£o das frases."
        }
      }
    }
  },
  'Geografia': {
    '4¬∫ ano': {
      'Brasil': {
        questions: [
          {
            content: "Qual √© a capital do Brasil?",
            choices: ["S√£o Paulo", "Rio de Janeiro", "Bras√≠lia", "Salvador"],
            answer: "Bras√≠lia",
            word: "capital"
          },
          {
            content: "Qual √© a maior floresta do Brasil?",
            choices: ["Mata Atl√¢ntica", "Caatinga", "Amaz√¥nia", "Cerrado"],
            answer: "Amaz√¥nia",
            word: "floresta"
          },
          {
            content: "Quantas regi√µes o Brasil possui?",
            choices: ["3 regi√µes", "4 regi√µes", "5 regi√µes", "6 regi√µes"],
            answer: "5 regi√µes",
            word: "regi√£o"
          },
          {
            content: "Qual oceano banha o litoral brasileiro?",
            choices: ["Oceano Pac√≠fico", "Oceano Atl√¢ntico", "Oceano √çndico", "Oceano √Årtico"],
            answer: "Oceano Atl√¢ntico",
            word: "litoral"
          }
        ],
        story: {
          title: "Descobrindo o Brasil",
          content: "O Brasil √© um pa√≠s continental cheio de diversidades. Das praias do nordeste √†s montanhas do sul, das florestas da Amaz√¥nia ao pantanal, cada regi√£o tem suas belezas e caracter√≠sticas √∫nicas. Conhecer o pr√≥prio pa√≠s √© uma aventura geogr√°fica emocionante!"
        }
      }
    },
    '7¬∫ ano': {
      'Continentes': {
        questions: [
          {
            content: "Quantos continentes existem no planeta Terra?",
            choices: ["5 continentes", "6 continentes", "7 continentes", "8 continentes"],
            answer: "7 continentes",
            word: "continente"
          },
          {
            content: "Qual √© o maior continente do mundo?",
            choices: ["√Åfrica", "√Åsia", "Am√©rica", "Europa"],
            answer: "√Åsia",
            word: "maior"
          },
          {
            content: "Em qual continente fica o Brasil?",
            choices: ["√Åfrica", "√Åsia", "Am√©rica", "Europa"],
            answer: "Am√©rica",
            word: "localiza√ß√£o"
          },
          {
            content: "Qual continente √© conhecido como o ber√ßo da humanidade?",
            choices: ["√Åsia", "Europa", "√Åfrica", "Oceania"],
            answer: "√Åfrica",
            word: "ber√ßo"
          }
        ],
        story: {
          title: "Volta ao Mundo",
          content: "Imagine dar a volta ao mundo visitando todos os continentes: a tecnologia da √Åsia, a hist√≥ria da Europa, a natureza da √Åfrica, a diversidade das Am√©ricas, a Oceania com suas ilhas paradis√≠acas, e a misteriosa Ant√°rtida. Cada continente tem culturas, climas e paisagens √∫nicos para descobrir!"
        }
      }
    }
  }
};

export const getGranularFallback = (gameParams: GameParameters, contentType: 'question' | 'story'): GranularQuestion | GranularStory | null => {
  const { subject, schoolGrade, theme } = gameParams;
  
  console.log(`[GRANULAR-FALLBACK] Buscando: ${subject} > ${schoolGrade} > ${theme}`);
  
  const subjectFallbacks = granularFallbacks[subject];
  if (!subjectFallbacks) {
    console.log(`[GRANULAR-FALLBACK] Mat√©ria ${subject} n√£o encontrada`);
    return null;
  }
  
  const gradeFallbacks = subjectFallbacks[schoolGrade];
  if (!gradeFallbacks) {
    console.log(`[GRANULAR-FALLBACK] S√©rie ${schoolGrade} n√£o encontrada para ${subject}`);
    return null;
  }
  
  const themeFallbacks = gradeFallbacks[theme];
  if (!themeFallbacks) {
    console.log(`[GRANULAR-FALLBACK] Tema ${theme} n√£o encontrado para ${subject} - ${schoolGrade}`);
    return null;
  }
  
  if (contentType === 'question') {
    const questions = themeFallbacks.questions;
    if (questions && questions.length > 0) {
      // Sempre retornar todas as 4 quest√µes dispon√≠veis
      console.log(`[GRANULAR-FALLBACK] Retornando ${questions.length} quest√µes espec√≠ficas para ${subject} - ${schoolGrade} - ${theme}`);
      return questions;
    }
  }
  
  if (contentType === 'story') {
    const story = themeFallbacks.story;
    if (story) {
      console.log(`[GRANULAR-FALLBACK] Retornando hist√≥ria espec√≠fica para ${subject} - ${schoolGrade} - ${theme}`);
      return story;
    }
  }
  
  console.log(`[GRANULAR-FALLBACK] Conte√∫do ${contentType} n√£o encontrado para ${subject} - ${schoolGrade} - ${theme}`);
  return null;
};

// Fun√ß√£o para verificar se existe fallback granular
export const hasGranularFallback = (gameParams: GameParameters): boolean => {
  const { subject, schoolGrade, theme } = gameParams;
  return !!(granularFallbacks[subject]?.[schoolGrade]?.[theme]);
};

// Fun√ß√£o para listar temas dispon√≠veis por mat√©ria e s√©rie
export const getAvailableThemes = (subject: string, schoolGrade: string): string[] => {
  const gradeFallbacks = granularFallbacks[subject]?.[schoolGrade];
  return gradeFallbacks ? Object.keys(gradeFallbacks) : [];
};
